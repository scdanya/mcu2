[gcode_macro First]
gcode:
  Move_pad MOVE=109
  RESPOND PREFIX=tgalarm MSG="Планшет в первом положении"
  RESPOND PREFIX=tgnotify_photo 
  M400

[gcode_macro Second]
gcode:
  Move_pad MOVE=91
  RESPOND PREFIX=tgalarm MSG="Планшет во втором положении"
  RESPOND PREFIX=tgnotify_photo 
  M400

[gcode_macro Third]
gcode:
  Move_pad MOVE=73
  RESPOND PREFIX=tgalarm MSG="Планшет в третьем положении"
  RESPOND PREFIX=tgnotify_photo 
  M400
  
[gcode_macro Fourth]
gcode:
  Move_pad MOVE=55
  RESPOND PREFIX=tgalarm MSG="Планшет в четвертом положении"
  RESPOND PREFIX=tgnotify_photo 
  M400

[gcode_macro Fifth]
gcode:
  Move_pad MOVE=37
  RESPOND PREFIX=tgalarm MSG="Планшет в пятом положении"
  RESPOND PREFIX=tgnotify_photo 
  M400

[gcode_macro Sixth]
gcode:
  Move_pad MOVE=20
  RESPOND PREFIX=tgalarm MSG="Планшет в шестом положении"
  RESPOND PREFIX=tgnotify_photo 
  M400

[gcode_macro Sponge]
gcode:
  Move_pad MOVE=142
  RESPOND PREFIX=tgalarm MSG="Планшет в положении под губкой"
  M400

[gcode_macro Take_out]
gcode:
  Move_pad move=310
  RESPOND PREFIX=tgalarm MSG="ЗАБЕРИТЕ ПЛАНШЕТ!!"
  RESPOND PREFIX=tgnotify_photo 
  M400
  
[gcode_macro Home]
gcode:
    MANUAL_STEPPER STEPPER=line_pad ENABLE=1 SPEED=25 SET_POSITION=320 MOVE=0 STOP_ON_ENDSTOP=1
    RESPOND PREFIX=tgalarm MSG="Планшет в начальном положении"
    M400

[gcode_macro Move_pad]
gcode: 
    {% set dist = params.MOVE|default(5) %}
      MANUAL_STEPPER STEPPER=sampling SPEED=25 MOVE={dist}
      M400

[gcode_macro Enable_pump_pad]
gcode:
    {% set state = params.ENABLE|default(1) %}
    {% set pumps = ['sampling'] %}
    {% for pump in pumps %}
        MANUAL_STEPPER STEPPER={pump} ENABLE={state}
    {% endfor %}

[gcode_macro Disable_pump_pad]
gcode: 
    {% set state = params.ENABLE|default(0) %}
    {% set pumps = ['sampling'] %}
    {% for pump in pumps %}
        MANUAL_STEPPER STEPPER={pump} ENABLE={state}
    {% endfor %}

[gcode_macro sampling]
gcode:
    M400
    {% set speed = params.SPEED|default(0.5) %}
    {% set syn = params.SYNC|default(0) %}
    {% set purge_distance = params.MOVE|default(2) %}
    {% set pump = params.STEPPER|default('sampling') %}
    MANUAL_STEPPER STEPPER={pump} MOVE={purge_distance} SPEED={speed} SYNC={syn} SET_POSITION=0 
    RESPOND PREFIX=tgalarm MSG="Выполнен отбор помпой {pump} на {purge_distance} шагов со скоростью {speed} мм/сек"
    MANUAL_STEPPER STEPPER={pump} ENABLE=0